<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="shortcut icon"
        href="https://upload.wikimedia.org/wikipedia/commons/thumb/6/66/Google_Docs_2020_Logo.svg/436px-Google_Docs_2020_Logo.svg.png"
        type="image/x-icon">
    <title>S·∫Øp x·∫øp c√¥ng nh√¢n</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        textarea,
        button {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            font-size: 16px;
        }

        textarea {
            border-radius: 20px;
        }

        button {
            background: #28a745;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background: #218838;
        }

        table {
            width: 30%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }

        th {
            background: #f4f4f4;
        }

        td {
            user-select: all;
        }

        .edit {
            background: #fffbcc;
        }

        .bx-copy {
            cursor: pointer;
            font-size: 20px;
        }

        .sc-a {
            border-radius: 20px;
        }
    </style>
</head>

<body>

    <h2>Nh·∫≠p d·ªØ li·ªáu</h2>
    <textarea id="inputData" rows="5" placeholder="D√°n d·ªØ li·ªáu v√†o ƒë√¢y...‚úçÔ∏è"></textarea>
    <button class="sc-a" onclick="processData()">X·ª≠ l√Ω</button>

    <h2>K·∫øt qu·∫£</h2>
    <p id="summary"></p>
    <table>
        <thead>
            <tr>
                <th onclick="copyColumn(0)">T√™n <i class='bx bx-copy'></i></th>
                <th onclick="copyColumn(1)">C√¥ng <i class='bx bx-copy'></i></th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>

    <script>
        function processData() {
            let input = document.getElementById("inputData").value.trim();
            if (input === "") {
                alert("Vui l√≤ng nh·∫≠p d·ªØ li·ªáu!");
                return;
            }

            let rows = input.split(/\n/);
            let data = [];

            rows.forEach(row => {
                // X√≥a emoji v√† kho·∫£ng tr·∫Øng th·ª´a
                row = row.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g, "").trim();

                // T√°ch theo kho·∫£ng tr·∫Øng l·ªõn
                let columns = row.split(/\s{2,}/).map(col => col.trim());

                columns.forEach(col => {
                    let match = col.match(/(.+?)[:\-]\s*([\d.,]+)\s*c√¥ng/i);
                    if (match) {
                        let name = match[1].trim();
                        let cong = parseFloat(match[2].replace(',', '.').trim());
                        if (!isNaN(cong)) {
                            data.push({ name, cong });
                        }
                    }
                });
            });

            if (data.length === 0) {
                alert("Kh√¥ng c√≥ d·ªØ li·ªáu h·ª£p l·ªá! Vui l√≤ng ki·ªÉm tra l·∫°i.");
                return;
            }

            // S·∫Øp x·∫øp theo c√¥ng gi·∫£m d·∫ßn
            data.sort((a, b) => b.cong - a.cong);

            // Hi·ªÉn th·ªã b·∫£ng
            let tableBody = document.getElementById("tableBody");
            tableBody.innerHTML = "";
            data.forEach(({ name, cong }) => {
                let row = document.createElement("tr");

                let nameCell = document.createElement("td");
                nameCell.textContent = name;
                row.appendChild(nameCell);

                let congCell = document.createElement("td");
                congCell.contentEditable = "true";
                congCell.classList.add("edit");
                congCell.textContent = cong;
                row.appendChild(congCell);

                tableBody.appendChild(row);
            });

            // Hi·ªÉn th·ªã t·ªïng
            let totalCong = data.reduce((sum, item) => sum + item.cong, 0);
            document.getElementById("summary").innerText =
                `üë∑‚Äç‚ôÇÔ∏è T·ªïng c√¥ng nh√¢n: ${data.length}, üßÆ T·ªïng c√¥ng: ${totalCong.toFixed(2)} c√¥ng`;

            alert("D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω th√†nh c√¥ng!");
        }

        function copyColumn(columnIndex) {
            let tableBody = document.getElementById("tableBody");
            let rows = tableBody.querySelectorAll("tr");
            let textToCopy = "";

            rows.forEach(row => {
                let cols = row.querySelectorAll("td");
                if (cols[columnIndex]) {
                    let value = cols[columnIndex].textContent.trim();

                    // N·∫øu l√† c·ªôt C√¥ng, ƒë·ªïi d·∫•u ch·∫•m th√†nh d·∫•u ph·∫©y
                    if (columnIndex === 1) {
                        value = value.replace(".", ",");
                    }

                    textToCopy += value +"\n"
                }
            });

            navigator.clipboard.writeText(textToCopy).then(() => {
                alert(`D·ªØ li·ªáu c·ªôt ${columnIndex === 0 ? "T√™n" : "C√¥ng"} ƒë√£ ƒë∆∞·ª£c sao ch√©p!`);
            }).catch(err => {
                alert("L·ªói khi sao ch√©p d·ªØ li·ªáu!");
                console.error(err);
            });
        }
    </script>
    <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
</body>

</html>
